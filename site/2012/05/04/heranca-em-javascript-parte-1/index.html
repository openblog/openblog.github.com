<!doctype html>
<html lang="pt-BR">

<head>
	<meta charset="UTF-8" />
	
		<title>Herança em JavaScript parte I | Open Blog</title>
	
	
		<meta name="author" content="Caio Gondim" />
	
	
		<meta name="keywords" content="javascript, js, web development, desenvolvimento web, html5, front-end, programação, oop, orientação a objetos, herança, orientação a protótipos, java
" />
	
	
		<meta name="description" content="Uma das coisas que mais assusta programadores vindos de linguagens orientadas a objeto, como Java e C++, é a falta de classes em JavaScript. Muitos, inclusive, tentam simular este comportamento no JavaScript, mas poucos conseguem com sucesso. Neste post numa série de 2, iremos relembrar o que é herança, a cadeia de protótipos e como era feito a herança em JavaScript." />
	
	<meta name="language" content="pt" />
	<meta name="content-language" content="pt-BR" />
	<meta name="robots" content="all" />
	<meta name="distribution" content="Global" />
	<meta name="resource-type" content="document" />

	<link rel="icon" type="image/png" href="/assets/img/favicon.png" />
    <link href="/assets/css/screen.css?2013-02-22" media="screen, projection" rel="stylesheet" type="text/css" />
    <!--[if IE]>
    	<link href="/assets/css/ie.css?2013-02-22" media="screen, projection" rel="stylesheet" type="text/css" />
  	<![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Ubuntu:300' rel='stylesheet' type='text/css'>
</head>

<body>

	<div id="wrapper">
		
		<header id="main">
	<h1><a href="/" id="logo">.openBlog()</a></h1>
</header>
		
		<section id="content">

			<section class="post-container" itemscope itemtype="http://schema.org/BlogPosting">
				<span class="hidden" itemprop="publisher">Open Blog</span>
				<article>
					<header>
						<h1><a href="/2012/05/04/heranca-em-javascript-parte-1/" itemprop="headline">Herança em JavaScript <span class="light">parte I</span></a></h1>
					</header>
					<section itemprop="articleBody">
						
						<figure>
							<img itemprop="thumbnailUrl" src="/images/posts/2012-05-04-heranca-em-javascript.jpg" class="post-image" alt="Herança em JavaScript parte I" title="Herança em JavaScript parte I" width="700" height="432" />
						</figure>
						
						<p>Diferente das linguagens mais conhecidas, como Java ou C++ que utilizam a orientação a objetos clássica, JavaScript utiliza uma abordagem diferente para compartilhar código entre entidades, chamada de orientação a protótipo. Mas antes de entrarmos em detalhes, vamos primeiro relembrar o que é a herança clássica nas linguagens orientadas a objetos.</p>

<h2 id='herana_clssica'>Herança clássica</h2>

<p>Herança em OOP é a capacidade de classes <strong>compartilharem</strong> atributos e métodos entre si. Geralmente a herança é usada para compartilhar comportamentos generalizados e comuns entres as classes filhas.</p>

<h3 id='show_me_the_code'>Show me the code</h3>

<p>Imaginem que temos que representar em nossa aplicação alguns animais, como gato e cachorro. Com herança podemos definir comportamentos comuns entre eles apenas uma vez, como respirar, nascer e morrer, e reutilizar estes métodos já implementados apenas os herdando nas classes filhas.</p>

<p>Vamos implementar o cenário acima em Java. Como desejamos representar gatos e cachorros, e sabemos que eles possuem métodos similares, como nascer, morrer e respirar, vamos criar uma classe Animal e implementar estes métodos nela, para que gatos e cachorros possam herdá-los.</p>
<div class='highlight'><pre><code class='java'><span class='c1'>// setamos a classe como abstrata pois não desejamos criar</span>
<span class='c1'>// objetos do tipo animal, apenas os tipos mais</span>
<span class='c1'>// especializados como Gato ou Cachorro podem ser instânciados</span>
<span class='kd'>public</span> <span class='kd'>abstract</span> <span class='kd'>class</span> <span class='nc'>Animal</span> <span class='o'>{</span>
  <span class='kd'>public</span> <span class='kt'>void</span> <span class='nf'>nascer</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='c1'>// ...</span>
  <span class='o'>}</span>

  <span class='kd'>public</span> <span class='kt'>void</span> <span class='nf'>morrer</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='c1'>// ...</span>
  <span class='o'>}</span>

  <span class='kd'>public</span> <span class='kt'>void</span> <span class='nf'>respirar</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='c1'>// ...</span>
  <span class='o'>}</span>
<span class='o'>}</span>
</code></pre></div>
<p>Agora definimos as classes Gato e Cachorro, que irão herdar de Animal e implementar métodos que só fazem sentido em seu próprio escopo, como miar no caso de Gato e latir no caso de Cachorro.</p>
<div class='highlight'><pre><code class='java'><span class='c1'>// além do método miar, os objetos do tipo Gato</span>
<span class='c1'>// terão também, devido a herança, os métodos de Animal</span>
<span class='kd'>class</span> <span class='nc'>Gato</span> <span class='kd'>extends</span> <span class='n'>Animal</span> <span class='o'>{</span>
  <span class='kd'>public</span> <span class='kt'>void</span> <span class='nf'>miar</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='c1'>// ...</span>
  <span class='o'>}</span>

  <span class='c1'>// construtor</span>
  <span class='kd'>public</span> <span class='nf'>Gato</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='c1'>// ...</span>
  <span class='o'>}</span>
<span class='o'>}</span>

<span class='c1'>// com os objetos do tipo Cachorro acontece o mesmo</span>
<span class='c1'>// além do método latir, definido explicitamente na classe</span>
<span class='c1'>// ele irá herdar os métodos nascer, morrer e respirar</span>
<span class='kd'>class</span> <span class='nc'>Cachorro</span> <span class='kd'>extends</span> <span class='n'>Animal</span> <span class='o'>{</span>
  <span class='kd'>public</span> <span class='kt'>void</span> <span class='nf'>latir</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='c1'>// ...</span>
  <span class='o'>}</span>

  <span class='c1'>// construtor</span>
  <span class='kd'>public</span> <span class='nf'>Cachorro</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='c1'>// ...</span>
  <span class='o'>}</span>
<span class='o'>}</span>
</code></pre></div>
<p>Definimos a relação de herança com a palavra reservada <code>extends</code>. Com isso as classes Gato e Cachorro irão possuir, além de seus próprios métodos, os métodos herdados de Animal, como nascer, morrer e respirar.</p>

<p>Então fica claro que com herança conseguimos um enorme reuso de código. De outra forma, teríamos que redefinir métodos e atributos comuns em todas as classes, tornando a manutenção do código mais complexa e propensa a erros.</p>

<h2 id='cadeia_de_prottipos'>Cadeia de protótipos</h2>

<p>Em JavaScript (quase) tudo é um objeto, não existem classes. Até mesmo as <code>function</code> são objetos. Se quisermos herdar os métodos e atributos de um objeto, o utilizamos como protótipo do novo objeto a ser criado. Mesmo que não esteja definido explicitamente no código, todos os outros objetos de JavaScript, com a exceção do objeto <code>Object</code>, utilizam um outro objeto como protótipo.</p>

<p>Como no exemplo abaixo, definimos um objeto vazio, um array vazio e uma função. Eles todos herdarão métodos e atributos de seus protótipos.</p>
<div class='highlight'><pre><code class='javascript'><span class='c1'>// aqui criamos um novo objeto genérico com o nome carro</span>
<span class='c1'>// ele automaticamente usará o prototipo de Object</span>
<span class='kd'>var</span> <span class='nx'>carro</span> <span class='o'>=</span> <span class='p'>{}</span>
<span class='nx'>carro</span><span class='p'>.</span><span class='nx'>modelo</span> <span class='o'>=</span> <span class='s1'>&#39;Celta&#39;</span>
<span class='nx'>carro</span><span class='p'>.</span><span class='nx'>marca</span> <span class='o'>=</span> <span class='s1'>&#39;Chevrolet&#39;</span>
<span class='nx'>carro</span><span class='p'>.</span><span class='nx'>hasOwnProperty</span><span class='p'>(</span><span class='s1'>&#39;modelo&#39;</span><span class='p'>)</span> <span class='c1'>// método herdado de Object</span>
<span class='nb'>Object</span><span class='p'>.</span><span class='nx'>getPrototypeOf</span><span class='p'>(</span><span class='nx'>carro</span><span class='p'>)</span> <span class='c1'>// retorna Object</span>

<span class='c1'>// frutas herdará as propriedades de Array</span>
<span class='kd'>var</span> <span class='nx'>frutas</span> <span class='o'>=</span> <span class='p'>[</span> <span class='s1'>&#39;morango&#39;</span><span class='p'>,</span> <span class='s1'>&#39;manga&#39;</span><span class='p'>,</span> <span class='s1'>&#39;laranja&#39;</span> <span class='p'>]</span>
<span class='nx'>frutas</span><span class='p'>.</span><span class='nx'>reverse</span><span class='p'>()</span> <span class='c1'>// método herdado de Array</span>
<span class='nx'>frutas</span><span class='p'>.</span><span class='nx'>hasOwnProperty</span><span class='p'>(</span><span class='s1'>&#39;length&#39;</span><span class='p'>)</span> <span class='c1'>// método herdado de Object</span>
<span class='nb'>Object</span><span class='p'>.</span><span class='nx'>getPrototypeOf</span><span class='p'>(</span><span class='nx'>frutas</span><span class='p'>)</span> <span class='c1'>// retorna []</span>
<span class='nb'>Object</span><span class='p'>.</span><span class='nx'>getPrototypeOf</span><span class='p'>(</span><span class='nb'>Object</span><span class='p'>.</span><span class='nx'>getPrototypeOf</span><span class='p'>(</span><span class='nx'>frutas</span><span class='p'>))</span> <span class='c1'>// retorna Object</span>

<span class='c1'>// validarCPF irá herdar propriedades de Function</span>
<span class='kd'>function</span> <span class='nx'>validarCPF</span><span class='p'>()</span> <span class='p'>{</span>
  <span class='c1'>// ...</span>
  <span class='k'>return</span> <span class='kc'>true</span>
<span class='p'>}</span>
<span class='c1'>// aqui vemos uma função se comportando como um objeto</span>
<span class='nx'>validarCPF</span><span class='p'>.</span><span class='nx'>call</span><span class='p'>()</span> <span class='c1'>// método herdado de Function</span>
<span class='nb'>Object</span><span class='p'>.</span><span class='nx'>getPrototypeOf</span><span class='p'>(</span><span class='nx'>validarCPF</span><span class='p'>)</span> <span class='c1'>// retorna function Empty() {}</span>
</code></pre></div>
<p>É interessante notar que a herança ocorre em <strong>toda</strong> a cadeia de protótipos. Como quando definimos um array: ele herda todas as propriedades de Array e de Object, uma vez que Array usa Object como protótipo. Podemos verificar isso chamando o protótipo do protótipo de frutas. O protótipo de frutas é Array, e o protótipo de Array é Object ou, o protótipo do protótipo de frutas é Object.</p>

<p>Quando chamamos a propriedade de um objeto, o interpretador/VM JavaScript primeiro procura esta propriedade dentro do objeto, caso não encontre procura em seu protótipo, caso não encontre novamente procura no protótipo do protótipo, e assim sucessivamente, percorrendo toda a cadeia de protótipos até alcançar um protótipo com valor <code>null</code>.</p>

<h2 id='herana_em_javascript_com_construtores'>Herança em JavaScript com construtores</h2>

<p>O método mais difundido e crossbrowser de criação de objetos e herança em JavaScript é através de funções que funcionam como construtores. Nesse método, definimos funções que irão se comportar como construtores em linguagens clássicas orientadas a objeto. Depois de definida a função, podemos instanciar objetos do tipo definido usando <code>new</code>.</p>

<p>Em JavaScript, uma função também é um objeto, e ela possui a propriedade <code>prototype</code>. Nesta propriedade definimos o prototipo da função, ou todas as propriedades que os objetos deste tipo irão ter se invocarmos <code>new</code>.</p>

<p>Ok, pode parecer complicado falando, mas fica bem fácil olhando o código.</p>
<div class='highlight'><pre><code class='javascript'><span class='c1'>// criamos o construtor Animal</span>
<span class='kd'>function</span> <span class='nx'>Animal</span><span class='p'>()</span> <span class='p'>{</span>
<span class='p'>}</span>
<span class='nx'>Animal</span><span class='p'>.</span><span class='nx'>prototype</span><span class='p'>.</span><span class='nx'>nascer</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
  <span class='c1'>// ...</span>
<span class='p'>}</span>
<span class='nx'>Animal</span><span class='p'>.</span><span class='nx'>prototype</span><span class='p'>.</span><span class='nx'>morrer</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
  <span class='c1'>// ...</span>
<span class='p'>}</span>
<span class='nx'>Animal</span><span class='p'>.</span><span class='nx'>prototype</span><span class='p'>.</span><span class='nx'>respirar</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
  <span class='c1'>// ...</span>
<span class='p'>}</span>
</code></pre></div>
<p>Agora definimos Gato e Cachorro, e usamos Animal como protótipo.</p>
<div class='highlight'><pre><code class='javascript'><span class='c1'>// criamos o construtor Gato</span>
<span class='kd'>function</span> <span class='nx'>Gato</span><span class='p'>(</span><span class='nx'>nome</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='k'>this</span><span class='p'>.</span><span class='nx'>nome</span> <span class='o'>=</span> <span class='nx'>nome</span>
<span class='p'>}</span>
<span class='nx'>Gato</span><span class='p'>.</span><span class='nx'>prototype</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Animal</span><span class='p'>()</span> <span class='c1'>// definimos que Gato usa Animal como protótipo</span>
<span class='nx'>Gato</span><span class='p'>.</span><span class='nx'>prototype</span><span class='p'>.</span><span class='nx'>constructor</span> <span class='o'>=</span> <span class='nx'>Gato</span> <span class='c1'>// para que não fique com o valor do construtor do objeto usado como protótipo</span>
<span class='nx'>Gato</span><span class='p'>.</span><span class='nx'>prototype</span><span class='p'>.</span><span class='nx'>miar</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span> <span class='c1'>// método miar apenas para Gato</span>
  <span class='c1'>// ...</span>
<span class='p'>}</span>

<span class='c1'>// criamos o construtor Cachorro</span>
<span class='kd'>function</span> <span class='nx'>Cachorro</span><span class='p'>(</span><span class='nx'>nome</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='k'>this</span><span class='p'>.</span><span class='nx'>nome</span> <span class='o'>=</span> <span class='nx'>nome</span>
<span class='p'>}</span>
<span class='nx'>Cachorro</span><span class='p'>.</span><span class='nx'>prototype</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Animal</span><span class='p'>()</span> <span class='c1'>// definimos que Cachorro usa Animal como protótipo</span>
<span class='nx'>Cachorro</span><span class='p'>.</span><span class='nx'>prototype</span><span class='p'>.</span><span class='nx'>constructor</span> <span class='o'>=</span> <span class='nx'>Cachorro</span><span class='p'>()</span>
<span class='nx'>Cachorro</span><span class='p'>.</span><span class='nx'>prototype</span><span class='p'>.</span><span class='nx'>latir</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
  <span class='c1'>// ...</span>
<span class='p'>}</span>

<span class='kd'>var</span> <span class='nx'>rex</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Cachorro</span><span class='p'>(</span><span class='s1'>&#39;rex&#39;</span><span class='p'>)</span> <span class='c1'>// criamos um objeto do tipo Cachorro</span>
<span class='nx'>rex</span><span class='p'>.</span><span class='nx'>latir</span><span class='p'>()</span> <span class='c1'>// utilizando um método definido em Cachorro</span>
<span class='nx'>rex</span><span class='p'>.</span><span class='nx'>respirar</span><span class='p'>()</span> <span class='c1'>// utilizando um método herdado de Animal</span>
<span class='nx'>rex</span><span class='p'>.</span><span class='nx'>nome</span> <span class='c1'>// retorna &#39;rex&#39;</span>
</code></pre></div>
<p>Precisamos criar um novo objeto do tipo Animal para setarmos como protótipo, pois caso contrário estariamos passando a referência para a função.</p>

<p>A propriedade <code>constructor</code> nos informa o construtor do objeto. Nós precisamos defini-la manualmente pois esta proprieda existe no objeto Animal que passamos por protótipo, então todos os objetos de Cachorro e Gato irão herdar a propriedade construtor com o setado valor como Animal. Esta propriedade pode ser útil caso seja preciso chamar um método de um dos objetos na cadeia de protótipos.</p>

<p>Podemos verificar que rex é de fato um cachorro perguntado se ele é uma instância de Cachorro.</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>rex</span> <span class='k'>instanceof</span> <span class='nx'>Cachorro</span> <span class='c1'>// retorna true</span>
<span class='nx'>rex</span> <span class='k'>instanceof</span> <span class='nx'>Animal</span> <span class='c1'>// retorn true. Cachorro.prototype --&gt; Animal</span>
<span class='nx'>rex</span> <span class='k'>instanceof</span> <span class='nb'>Object</span> <span class='c1'>// retorna true. Cachorro.prototype --&gt; Animal.prototype --&gt; Object</span>
<span class='nx'>rex</span> <span class='k'>instanceof</span> <span class='nb'>Array</span> <span class='c1'>// retorna false</span>
</code></pre></div>
<p>Interessante notar que rex também é uma instância de Animal, já que Cachorro usa Animal como protótipo. E também é instância de Object, já que Animal usa, implicitamente, Object como protótipo.</p>

<p>Por ser uma linguagem orientada a protótipos, nós podemos definir um novo ao método ao protótipo e todos os objetos já instanciados irão ter acesso a este método criado, o que é impossível de ser feito em linguagens como Java (me corrijam se estiver falando besteira).</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>Cachorro</span><span class='p'>.</span><span class='nx'>prototype</span><span class='p'>.</span><span class='nx'>morder</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
  <span class='c1'>// ...</span>
<span class='p'>}</span>
<span class='nx'>rex</span><span class='p'>.</span><span class='nx'>morder</span><span class='p'>()</span> <span class='c1'>// rex mesmo depois de instanciado terá acesso aos novos métodos definidos no protótipo de Cachorro</span>
</code></pre></div>
<p>Um dos perigos dessa abordagem é que caso se esqueça de usar <code>new</code>, o <code>this</code> dentro da <code>function</code> irá se referenciar ao objeto global, e poderá sobreescrever algumas variáveis já declaradas antes.</p>

<p>Eu particularmente não sou a favor do uso do <code>new</code> pois ele torna ambíguo o uso de funções. Pois algumas funcionam como construtores e outras como funções normais. E sintaticamente o <code>new</code> pode ser usado em qualquer tipo de função.</p>

<h3 id='continua'>Continua&#8230;</h3>

<p>Este é o método padrão de herança em JavaScript. Grande parte desta bagunça é devido ao JavaScript ter sido lançado <strong>muito</strong> às pressas. Porém o ECMAscript, o grupo que padroniza o JavaScript, vem adicionado várias funções para tornar o trabalho com herança mais simples e finalmente abraçando a orientação a protótipo.</p>

<p>E é sobre este novo método de trabalhar com herança no ECMAscript 5 que iremos discutir na <a href='http://loopinfinito.com.br/2013/02/01/heranca-em-javascript-parte-2/'>2ª parte do post</a>.</p>
<aside class='fonte'>
  <h3>Referência</h3>
  <ul>
    <li>→<a href='https://developer.mozilla.org/en/JavaScript/Guide/Inheritance_and_the_prototype_chain'>Mozilla Developer Network: Inheritance and the Prototype Chain</a></li>
    <li>→<a href='http://stackoverflow.com/questions/2709612/using-object-create-instead-of-new'>StackOverflow: Using Object.create() instead of new</a></li>
    <li>→<a href='http://joost.zeekat.nl/constructors-considered-mildly-confusing.html'>code.h(oe)kje: Constructors considered mildly confusing</a></li>
  </ul>
</aside>
					</section>
				</article>
			</section>

		</section><!-- end #content -->

	</div><!-- end #wrapper -->

</body>
</html>
