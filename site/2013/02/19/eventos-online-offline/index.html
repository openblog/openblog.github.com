<!doctype html>
<html lang="pt-BR">

<head>
	<meta charset="UTF-8" />
	
		<title>Eventos online e offline | Open Blog</title>
	
	
		<meta name="author" content="Caio Gondim" />
	
	
		<meta name="keywords" content="html5, eventos, events, javascript, online, offline, rede, internet, net, conexão, connection
" />
	
	
		<meta name="description" content="Mais uma API simples e útil do HTML5. Com ela temos acesso, de forma nativa, ao status da conexão do navegador, ou seja, se ele tem acesso ou não à rede." />
	
	<meta name="language" content="pt" />
	<meta name="content-language" content="pt-BR" />
	<meta name="robots" content="all" />
	<meta name="distribution" content="Global" />
	<meta name="resource-type" content="document" />

	<link rel="icon" type="image/png" href="/assets/img/favicon.png" />
    <link href="/assets/css/screen.css?2013-02-22" media="screen, projection" rel="stylesheet" type="text/css" />
    <!--[if IE]>
    	<link href="/assets/css/ie.css?2013-02-22" media="screen, projection" rel="stylesheet" type="text/css" />
  	<![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Ubuntu:300' rel='stylesheet' type='text/css'>
</head>

<body>

	<div id="wrapper">
		
		<header id="main">
	<h1><a href="/" id="logo">.openBlog()</a></h1>
</header>
		
		<section id="content">

			<section class="post-container" itemscope itemtype="http://schema.org/BlogPosting">
				<span class="hidden" itemprop="publisher">Open Blog</span>
				<article>
					<header>
						<h1><a href="/2013/02/19/eventos-online-offline/" itemprop="headline">Eventos online e offline</a></h1>
					</header>
					<section itemprop="articleBody">
						
						<figure>
							<img itemprop="thumbnailUrl" src="/images/posts/2013-02-19-eventos-online-offline.jpg" class="post-image" alt="Eventos online e offline" title="Eventos online e offline" width="700" height="432" />
						</figure>
						
						<p>Mais uma <abbr title='Application Program Interface'>API</abbr> simples e útil do <abbr title='HyperText Markup Language 5'>HTML5</abbr>. Com ela temos acesso, de forma nativa, ao <strong>status da conexão do navegador</strong>, ou seja, se ele tem acesso ou não à rede. Não confundir com acesso à internet, já que é possível estarmos conectados em uma rede local sem acesso externo à internet.</p>

<h2 id='api'>API</h2>

<p>A <abbr title='Application Program Interface'>API</abbr> é bem direta ao ponto. Basta adicionarmos <em>listeners</em> aos objetos <code>window</code>, <code>document</code> ou ao elemento <code>body</code> e passarmos a função que será executada uma vez que esses eventos forem disparados. O evento irá, na verdade, acontecer no elemento <code>body</code>, mas irá propagar até o objeto <code>window</code>, passando por <code>document</code>. Por isso podemos por o <em>listener</em> em qualquer um.</p>
<div class='highlight'><pre><code class='javascript'><span class='c1'>// javascript puro</span>
<span class='nb'>window</span><span class='p'>.</span><span class='nx'>addEventListener</span><span class='p'>(</span><span class='s1'>&#39;online&#39;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
  <span class='c1'>// ...</span>
<span class='p'>})</span>
<span class='nb'>window</span><span class='p'>.</span><span class='nx'>addEventListener</span><span class='p'>(</span><span class='s1'>&#39;offline&#39;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
  <span class='c1'>// ...</span>
<span class='p'>})</span>
</code></pre></div>
<p>No exemplo acima estamos escutando o evento através de JavaScript puro. No exemplo abaixo estamos usando jQuery. O método <code>on</code> é agora o método padrão para escutar eventos no jQuery, inclusive para os eventos clássicos como <code>click</code>, <code>hover</code>, etc. Os dois códigos são equivalentes.</p>
<div class='highlight'><pre><code class='javascript'><span class='c1'>// jQuery style</span>
<span class='nx'>$</span><span class='p'>(</span><span class='nb'>window</span><span class='p'>)</span>
  <span class='p'>.</span><span class='nx'>on</span><span class='p'>(</span><span class='s1'>&#39;online&#39;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='c1'>// ...</span>
  <span class='p'>})</span>
  <span class='p'>.</span><span class='nx'>on</span><span class='p'>(</span><span class='s1'>&#39;offline&#39;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
    <span class='c1'>// ...</span>
  <span class='p'>})</span>
</code></pre></div>
<h2 id='propriedade_online'>Propriedade online</h2>

<p>Também é possível detectar se o navegador está <em>online</em> de forma síncrona. Basta checar a propriedade <code>navigator.onLine</code>. Se ela retornar <code>true</code>, significa que estamos com conexão à rede, se retornar <code>false</code>&#8230;vocês entenderam.</p>
<div class='highlight'><pre><code class='javascript'><span class='k'>if</span> <span class='p'>(</span><span class='nx'>navigator</span><span class='p'>.</span><span class='nx'>onLine</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='c1'>// está online</span>
<span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span>
  <span class='c1'>// está offline</span>
<span class='p'>}</span>
</code></pre></div>
<h2 id='demo'>Demo</h2>

<p>O que melhor que um exemplo para demonstrar a nova <abbr title='Application Program Interface'>API</abbr>? Caso esteja usando o Chrome, Safari ou Internet Explorer, <strong>desconecte a sua máquina da rede desligando o <em>Wi-Fi</em></strong> ou desplugando o cabo <em>ethernet</em> para então ver uma animação informando que a conexão foi perdida. Caso esteja no Firefox, vá no menu <em>File</em> &gt; <em>Work Offline</em> para que o evento <em>offline</em> seja disparado. Conecte de novo e, quando a conexão retornar, o aviso irá sumir. Simples e lindo, hein?</p>

<h2 id='suporte_e_inconsistncias'>Suporte e Inconsistências</h2>

<p>Cada navegador interpreta o termo <em>offline</em> de maneiradiferente. A especificação do <abbr title='HyperText Markup Language 5'>HTML5</abbr> informa que o evento <em>offline</em> deve ser disparado quando o computador perder conexão com a rede, e não necessariamente com a internet.</p>
<blockquote>
  <p>
    Returns false if the user agent is definitely offline (disconnected from
    the network). Returns true if the user agent might be online. The events
    online and offline are fired when the value of this attribute changes.
  </p>
  <footer>
    – <abbr title='Web Hypertext Application Technology Working Group'>WHATWG</abbr>
    Browser state spec
  </footer>
</blockquote>
<p>O que significa que, se apenas a conexão entre seu <em>access point</em> e seu provedor de internet for perdida, o evento offline não será disparado. Mas caso a conexão entre o computador e o <em>access point</em> for perdida e esta for a única interface de rede de sua máquina, o evento <em>offline</em> será disparado.</p>

<p>O Firefox não implementa a <abbr title='Application Program Interface'>API</abbr> como definida na especificação e apenas dispara o evento quando explicitamente optamos que ele trabalhe no modo <em>offline</em>, como fizemos anteriormente no <em>demo</em>.</p>

<p>O Opera, apesar de apresentar a propriedade <code>navigator.onLine</code>, parece não implementar os eventos. E nem mesmo a propriedade é atualizada quando perdemos conexão com a rede.</p>
<table class='support'>
  <thead>
    <tr>
      <th class='subject'><h2>Suporte</h2></th>
      <th class='browser chrome'><div class='i' /></th>
      <th class='browser safari'><div class='i' /></th>
      <th class='browser firefox'><div class='i' /></th>
      <th class='browser ie'><div class='i' /></th>
      <th class='browser opera'><div class='i' /></th>
    </tr>
    <tr>
      <th />
      <th class='base' colspan='5' />
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class='property'><code>Eventos online/offline</code></td>
      <td>26.0</td>
      <td>6.0.2</td>
      <td>18.0</td>
      <td>10</td>
      <td>--</td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <td colspan='6'>
        A versões dos navegadores acima foram as usadas nos testes,
        mas não quer dizer que a <abbr title='Application Program Interface'>API</abbr>
        foi implementada desde a versão informada.
      </td>
    </tr>
  </tfoot>
</table>
<p>Infelizmente não achei, nem mesmo no <a href='http://caniuse.com/'>Can I Use</a>, uma tabela de suporte a estes eventos. Então na tabela acima estão todos os <em>browsers</em> com suas respectivas versões que usei para testar o experimento do <em>post</em>.</p>
<aside class='fonte'>
  <h3>Referência</h3>
  <ul>
    <li>→
      <a href='https://developer.mozilla.org/en-US/docs/Online_and_offline_events'>
			Online and offline events
      </a>
      <span class='comment'>// Mozilla Developer Network </span>
    </li>
    <li>→
      <a href='http://stackoverflow.com/questions/3181080/how-to-detect-online-offline-event-cross-browser'>
      How to detect online/offline event cross-browser?
      </a>
      <span class='comment'>// Stack Overflow</span>
    </li>
    <li>→
      <a href='http://www.whatwg.org/specs/web-apps/current-work/#browser-state'>
      Browser State
      </a>
      <span class='comment'>// WHATWG HTML5 Spec</span>
    </li>
  </ul>
</aside><style>

  /* Widget
   -------------------- */
  .widget-conexao-status {
    position: fixed;
    top: 50% !important;
    left: 50% !important;
    margin-top: -150px;
    margin-left: -150px;
    width: 300px !important;
    height: 300px !important;
    -webkit-border-radius: 10px;
    -moz-border-radius: 10px;
    -ms-border-radius: 10px;
    border-radius: 10px;
    background-color: rgba(0, 0, 0, 0.7);
    -webkit-box-shadow: rgba(0, 0, 0, 0.7);
    -moz-box-shadow: rgba(0, 0, 0, 0.7);
    -ms-box-shadow: rgba(0, 0, 0, 0.7);
    box-shadow: rgba(0, 0, 0, 0.7);
    opacity: 0;
  }

  /* Plug
   -------------------- */
  .widget-plug {
    position: absolute !important;
    background-image: none !important;
    background-color: transparent !important;
    -webkit-transition: all 0.4s ease-out 0.7s;
    -moz-transition: all 0.4s ease-out 0.7s;
    -ms-transition: all 0.4s ease-out 0.7s;
    transition: all 0.4s ease-out 0.7s;
  }

  .widget-plug-macho {
    width: 166px !important;
  }

  .widget-plug-femea {
    width: 140px !important;
  }

  /* Widget online
   -------------------- */
  .online .widget-conexao-status {
    opacity: 0;
    -webkit-transform: scale(1.3);
    -moz-transform: scale(1.3);
    -ms-transform: scale(1.3);
    transform: scale(1.3);
    -webkit-transition: all 0.4s 0.7s ease-out;
    -moz-transition: all 0.4s 0.7s ease-out;
    -ms-transition: all 0.4s 0.7s ease-out;
    transition: all 0.4s 0.7s ease-out;
  }
    .online .widget-plug {
      transform: scale(1);
      -webkit-transition: all 0.5s 0s ease-in;
      -moz-transition: all 0.5s 0s ease-in;
      -ms-transition: all 0.5s 0s ease-in;
      transition: all 0.5s 0s ease-in;
    }

    .online .widget-plug-macho {
      bottom: 45px !important;
      left: 45px !important;
    }

    .online .widget-plug-femea {
      top: 45px !important;
      left: 115px !important;
    }

  /* Widget offline
   -------------------- */
  .offline .widget-conexao-status {
    opacity: 1;
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -ms-transform: scale(1);
    transform: scale(1);
    -webkit-transition: all 0.5s ease-in;
    -moz-transition: all 0.5s ease-in;
    -ms-transition: all 0.5s ease-in;
    transition: all 0.5s ease-in;
  }

    .offline .widget-plug-macho {
      bottom: 20px !important;
      left: 20px !important;
    }

    .offline .widget-plug-femea {
      top: 20px !important;
      left: 140px !important;
    }

</style><div class='widget-conexao-status'>
  <img alt='Plug Macho' class='widget-plug widget-plug-macho' src='/images/posts/2013-02-19-plug-macho.png' />
  <img alt='Plug Fêmea' class='widget-plug widget-plug-femea' src='/images/posts/2013-02-19-plug-femea.png' />
</div><script>
  $(document).ready(function() {
    $('body')
      .addClass('online')

    $(window)
      .on('online', function(event) {
        $('body')
          .removeClass('offline')
          .addClass('online')
      })
      .on('offline', function(event) {
        $('body')
          .removeClass('online')
          .addClass('offline')
      })
  })
</script>
					</section>
				</article>
			</section>

		</section><!-- end #content -->

	</div><!-- end #wrapper -->

</body>
</html>
